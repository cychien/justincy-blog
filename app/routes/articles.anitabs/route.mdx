---
tag: htdt
title: "如何做 Animated Tabs"
description: 這次要實作的是 Animated Tabs，在這個 Tabs 裡 pill 代表著當前的 active tab，每當用戶切換 tab 時，這個 pill 就會從舊位置滑至新位置，pill 會隨著 tab 的切換而不停移動，並且只有 pill 上的字才會變色，確保維持高對比度。
published_at: 2023-08-23
cover: https://res.cloudinary.com/dgppby8lr/image/upload/v1692788682/blog/animated-tabs_r0ghgf.png
meta:
  - { title: Animated Tabs }
  - { description: 這次要實作的是 Animated Tabs，在這個 Tabs 裡 pill 代表著當前的 active tab，每當用戶切換 tab 時，這個 pill 就會從舊位置滑至新位置，pill 會隨著 tab 的切換而不停移動，並且只有 pill 上的字才會變色，確保維持高對比度。}
---

import CodeBlock from "~/components/site/mdx/CodeBlock"
import { AnimatedTabs } from "./AnimatedTabs"

這次要實作的是 Animated Tabs，在這個 Tabs 裡 pill 代表著當前的 active tab，每當用戶切換 tab 時，這個 pill 就會從舊位置**滑**至新位置，pill 會隨著 tab 的切換而不停移動，你可以試試下方的 component 實際看看效果。如果沒問題的話，我們就開始吧！

<div className='not-prose' style={{marginTop: '64px', marginBottom: '64px'}}>
  <AnimatedTabs />
</div>

Tools: React, Cotton UI, Framer Motion

## Shared layout animation

我們首先要用 Framer Motion 的 shared layout animation 實作 pill 移動效果，shared layout animation 指的是當一個新的 element 加入時，我們可以將某個舊 element 通過動畫方式讓它逐漸成為這個新 element。聽起來很科幻嗎？用用看就知道了！用法非常簡單，我們先在某個 element 上放一個 `layoutId`，接著再把這個 `layoutId` 從原本的地方拿掉，放到另一個 element 上，如此一來，Framer Motion 就會自動產生新舊 element 間的過渡動畫。

<CodeBlock>
```tsx
const languages = ["JavaScript", "Java", "Clojure", "Go", "Python"] as const;

function AnimatedTabs() {
  const defaultValue = languages[0];
  const { pathname, search } = useLocation();
  const tabsProps = useTabs({
    id: "animated-tabs",
    url: pathname + search,
    defaultValue,
  });

  return (
    <Tabs {...tabsProps}>
      <TabsList>
        {languages.map((lang) => (
          <TabsTrigger
            key={lang}
            value={lang}
            className="relative text-gray-900 data-[state=active]:text-white"
          >
            {lang}
            {tabsProps.value === lang && (
              <motion.div
                layoutId="pill"
                className="absolute inset-0 -z-10 rounded-full bg-black"
              />
            )}
          </TabsTrigger>
        ))}
      </TabsList>
      {languages.map((lang) => (
        <TabsContent key={lang} value={lang} />
      ))}
    </Tabs>
  );
}
```
</CodeBlock>

在上面的 code 裡，我們為 pill 加上 `layoutId=“pill”` 並且限制它只有當前 tab active 時才顯現，一旦 tab value 變化，例如從 “JavaScript” 變為 “Java”，那麼原先 “JavaScript” 的 pill 會消失，而 “Java” 的 pill 會出現，透過 Framer Motion，即使 element 不同我們依舊能讓 JavaScript 的 pill 與 Java 的 pill 間發生過渡動畫。

## border-radius distortion

做到這裡，雖然 pill 有動畫了，但當你放慢秒數去看，你會發現 `border-radius` 有點怪怪的。

![border-radius distortion gif](https://res.cloudinary.com/dgppby8lr/image/upload/c_crop,h_200/v1692792027/blog/output-onlinegiftools_1_djyokk.gif)

這發生的原因是由於 Framer Motion 的實現用了 FLIP 技巧。FLIP 雖然帶來魔法般的能力，卻也帶來像這樣的小困擾。在 FLIP 中，element 的 scale 往往會對某些 property 進行拉扯，如 `border-radius`，要解決的話必須讓 `border-radius` 往反方向拉扯，這不好做也有點複雜，好在 Framer Motion 有提供方法幫我們做 Scale correction，只要把要被 correct 的 property 用 inline style 的方式放在 motion element 上就好：

<CodeBlock>
```tsx
<motion.div
  layoutId="pill"
  className="absolute inset-0 -z-10 bg-black"
  style={{ borderRadius: 9999 }}
/>
```
</CodeBlock>

打開 devtool 看你會發現 Framer Motion 有幫你 correct scale 了！

![correct scale gif](https://res.cloudinary.com/dgppby8lr/image/upload/h_200/v1692793068/blog/CleanShot_2023-08-23_at_20.17.11_lj34zs.gif)

過渡動畫裡的 border-radius 也變正常了。

![border-radius fixed gif](https://res.cloudinary.com/dgppby8lr/image/upload/c_crop,h_200/v1692792567/blog/output-onlinegiftools_2_kj0kta.gif)

## mix-blend-mode: difference

接下來還有一個小奇怪要修正，在剛剛的畫面中你應該有注意到在 pill 還沒移到 tab 上時，tab 上的字就先變白，導致這個 tab 看起來消失了。

我們可以如何修正呢？

有一個很簡單的方法，就是運用 `mix-blend-mode: difference` 。`mix-blend-mode` 是一個 CSS 屬性，會把重合的地方依據不同的演算法進行混色，在 `mix-blend-mode: difference` 的算法裡，是用亮色減去暗色，如果 2 個顏色裡有其中之一是黑色，則另一個顏色因為是減去黑色，所以顏色並不會改變。

運用這個技巧，我們可以讓所有 tab 上的文字都保持黑色，然後讓 pill 這個**濾鏡**移動就好，如此一來，就可以避免字在 pill 還沒到就變白的問題，同時也可以讓一個字的任何部分都維持高對比度。

<CodeBlock>
```tsx
<TabsTrigger
  key={lang}
  value={lang}
  className="relative text-gray-900"
>
  {lang}
  {tabsProps.value === lang && (
    <motion.div
      layoutId="pill"
      className="absolute inset-0 z-10 bg-white mix-blend-difference"
      style={{ borderRadius: 9999 }}
    />
  )}
</TabsTrigger>
```
</CodeBlock>

![white text fixed](https://res.cloudinary.com/dgppby8lr/image/upload/c_crop,h_200/v1692793786/blog/output-onlinegiftools_4_f3wbhi.gif)

---

做到這裡，Animated Tabs 就完成啦，如果你想要 pill 移動的更自然，你可以加上 spring 效果：

<CodeBlock>
```tsx
<motion.div
  layoutId="pill"
  className="absolute inset-0 z-10 bg-white mix-blend-difference"
  style={{ borderRadius: 9999 }}
  transition={{
    type: "spring",
    duration: 0.6,
    bounce: 0.1,
  }}
/>
```
</CodeBlock>

最後附上完整程式碼：

<CodeBlock>
```tsx
const languages = ["JavaScript", "Java", "Clojure", "Go", "Python"] as const;

function AnimatedTabs() {
  const defaultValue = languages[0];
  const { pathname, search } = useLocation();
  const tabsProps = useTabs({
    id: "animated-tabs",
    url: pathname + search,
    defaultValue,
  });

  return (
    <Tabs {...tabsProps}>
      <TabsList>
        {languages.map((lang) => (
          <TabsTrigger
            key={lang}
            value={lang}
            className="relative text-gray-900"
          >
            {lang}
            {tabsProps.value === lang && (
              <motion.div
                layoutId="pill"
                className="absolute inset-0 z-10 bg-white mix-blend-difference"
                style={{ borderRadius: 9999 }}
                transition={{
                  type: "spring",
                  duration: 0.6,
                  bounce: 0.1,
                }}
              />
            )}
          </TabsTrigger>
        ))}
      </TabsList>
      {languages.map((lang) => (
        <TabsContent key={lang} value={lang} />
      ))}
    </Tabs>
  );
}
```
</CodeBlock>

以上就是這次的 How to do this，我們下篇再見！